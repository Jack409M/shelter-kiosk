{% extends "layout.html" %}
{% block content %}
<h1>Attendance for {{ shelter }}</h1>

<div class="card">
  <p class="hint">Search your browser page to find a name fast. On iPad, use the search bar in Safari.</p>
</div>

<h2>Attendance, {{ shelter }}</h2>

<h3>Currently out</h3>
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Name</th>
      <th>Time checked out</th>
      <th>Time expected back</th>
      <th>Time checked back in</th>
      <th>Overdue</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for r in out_rows %}
    <tr class="{% if r.is_overdue %}overdue{% endif %}">
      <td>{{ r.date }}</td>
      <td>{{ r.name }}</td>
      <td>{{ fmt_dt(r.checked_out_at) }}</td>
      <td>{{ fmt_dt(r.expected_back_at) }}</td>
      <td>{{ fmt_dt(r.checked_in_at) }}</td>
      <td>{% if r.is_overdue %}YES{% else %}NO{% endif %}</td>
      <td>
        <form method="post" action="{{ url_for('staff_attendance_check_in', resident_id=r.resident_id) }}">
          <input name="note" placeholder="Note (optional)">
          <button type="submit">Check in</button>
        </form>
      </td>
    </tr>
    {% endfor %}
    {% if out_rows|length == 0 %}
    <tr><td colspan="7">No one is currently out.</td></tr>
    {% endif %}
  </tbody>
</table>

<h3>Currently present</h3>
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Name</th>
      <th>Time checked out</th>
      <th>Time expected back</th>
      <th>Time checked back in</th>
      <th>Overdue</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for r in in_rows %}
    <tr>
      <td>{{ r.date }}</td>
      <td>{{ r.name }}</td>
      <td>{{ fmt_dt(r.checked_out_at) }}</td>
      <td>{{ fmt_dt(r.expected_back_at) }}</td>
      <td>{{ fmt_dt(r.checked_in_at) }}</td>
      <td>NO</td>
      <td>
        <form method="post" action="{{ url_for('staff_attendance_check_out', resident_id=r.resident_id) }}">
          <input type="datetime-local" name="expected_back_time">
          <input name="note" placeholder="Note (optional)">
          <button type="submit">Check out</button>
        </form>
      </td>
    </tr>
    {% endfor %}
    {% if in_rows|length == 0 %}
    <tr><td colspan="7">No one is currently present.</td></tr>
    {% endif %}
  </tbody>
</table>

<div class="card">
  <p class="hint">You will need to add residents to the roster in the database. I will give you the simple admin screen for that next.</p>
</div>

{% endblock %}




